<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    
    <!-- HTML Meta Tags -->
    <title>Arkham: Revived: Landing Page</title>
    <meta name="description" content="Arkham: Revived is a custom authentication server for Batman: Arkham Origins Online.">
    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://arkham.kiwifruitdev.page">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Arkham: Revived: Landing Page">
    <meta property="og:description" content="Arkham: Revived is a custom authentication server for Batman: Arkham Origins Online.">
    <meta property="og:image" content="https://arkham.kiwifruitdev.page/img/arkhamrevived3.png">
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="arkham.kiwifruitdev.page">
    <meta property="twitter:url" content="https://arkham.kiwifruitdev.page">
    <meta name="twitter:title" content="Arkham: Revived: Landing Page">
    <meta name="twitter:description" content="Arkham: Revived is a custom authentication server for Batman: Arkham Origins Online.">
    <meta name="twitter:image" content="https://arkham.kiwifruitdev.page/img/arkhamrevived3.png">
    <!-- Meta Tags Generated via https://www.opengraph.xyz -->
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>
<body>
    <nav class="grey darken-4" role="navigation">
      <div class="nav-wrapper container"><a id="logo-container" href="/" class="brand-logo">Arkham: Revived</a>
        <ul class="right hide-on-med-and-down">
          <li><a href="https://discord.gg/6Sab2tbauC">Discord</a></li>
          <li><a href="https://s.team/chat/FgPapTMc">Steam Chat</a></li>
        </ul>
  
        <ul id="nav-mobile" class="sidenav">
          <li><a href="https://discord.gg/6Sab2tbauC">Discord</a></li>
          <li><a href="https://s.team/chat/FgPapTMc">Steam Chat</a></li>
        </ul>
        <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
      </div>
    </nav>
    <main class="section grey darken-3" id="index-banner">
      <div class="container">
          <h1 class="header center green-text">Landing Page</h1>
          <div class="row center">
            <h5 class="header col s12 light white-text">Your Steam account is now logged in.</h5>
            <p class="col s12 white-text" id="persistence-text">
              If persistence is enabled, you cannot log in from a different IP address.
              <br>
              This is to ensure that your account cannot be impersonated.
              <br>
              Enable persistence mode once logged in to ensure security.
            </p>
          </div>
          <div class="row center">
            <img class="circle responsive-img scale-transition scale-out" id="profile-pic"></img>
            <h5 class="white-text" id="profile-name"></h5>
            <h5 class="header col s12 light white-text">What would you like to do?</h5>
            <p class="col s12 white-text" id="login-state">
              WBID: <span class="grey-text text-lighten-1 light" id="wbid"></span>
              <br>
              Location: <span class="grey-text text-lighten-1 light" id="lastlocation"></span>
              <br>
              Persistence: <span class="grey-text text-lighten-1 light" id="persistent"></span>
            </p>
            <br><br><br>
            <a href="/getting-started.html" class="btn waves-effect waves-light orange" id="get-started">Get Started</a>
            <a href="/auth/discord/" class="btn waves-effect waves-light blurple">Link to Discord</a>
            <br><br>
            <a href="/delete" class="btn waves-effect waves-light red persistencegoaway">Delete Progress</a>
            <br class="persistencegoaway"><br class="persistencegoaway">
            <a href="#!" class="btn waves-effect waves-light persistencegoaway" id="persistent-button"></a>
          </div>
      </div>
    </main>
    <footer class="page-footer grey darken-1">
        <div class="container">
            <div class="row">
                <div class="col l5 s12">
                    <h5 class="white-text">How it works</h5>
                    <p class="grey-text text-lighten-4">
                        Arkham: Revived is a third-party authentication server for Batman: Arkham Origins Online.
                        It allows you to sign in to the game using your Steam account to save progress.
                        Due to technical limitations, the server only knows your Steam information by your IP address.
                        This means that if your IP address changes, you will have to sign in again.
                        Linking with Steam is optional, but progress will not be saved otherwise.
                    </p>
                </div>
                <div class="col l5 s12">
                    <h5 class="white-text">Why?</h5>
                    <p class="grey-text text-lighten-4">
                        The official servers for Batman: Arkham Origins Online were shut down in 2016, however the game is still playable through a quick workaround.
                        The servers are not likely to stay up for much longer, so this project was created to allow players to continue playing the game once the servers finally shut down for good.
                        You must own the game on Steam to play, as the game still uses Steam for matchmaking and DLC verification.
                    </p>
                </div>
                <div class="col l2 s12">
                    <h5 class="white-text">Links</h5>
                    <ul>
                        <li><a class="blue-text text-lighten-3" href="https://discord.gg/6Sab2tbauC">Discord</a></li>
                        <li><a class="blue-text text-lighten-3" href="https://s.team/chat/FgPapTMc">Steam Chat</a></li>
                        <li><a class="blue-text text-lighten-3" href="https://github.com/KiwifruitDev/arkham-wbid-local-server">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <div class="container">
            Framework by <a class="orange-text text-lighten-3" href="http://materializecss.com">Materialize</a>.
            </div>
        </div>
    </footer>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="../js/init.js"></script>
    <script>
        M.AutoInit();
        // Pulls the URL parameters
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
        
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
        
            if (!results) return null;
            if (!results[2]) return '';
        
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
        // Sets the profile picture and name
        var profilePic = decodeURIComponent(getParameterByName('avatar'));
        var profileName = decodeURIComponent(getParameterByName('persona'));
        var steamid = decodeURIComponent(getParameterByName('steamid'));
        var accessed = decodeURIComponent(getParameterByName('accessed'));
        document.getElementById('profile-pic').src = profilePic;
        document.getElementById('profile-name').innerHTML = `${profileName}`;
        // scale-in
        if(accessed == 'true')
        {
            document.getElementById('profile-pic').classList.remove('scale-out');
            document.getElementById('profile-pic').classList.remove('scale-transition');
        }
        else
        {
            document.getElementById('profile-pic').classList.add('scale-in');
        }
        // Sets the persistent button state
        var persistent = decodeURIComponent(getParameterByName('persistent'));
        document.getElementById('persistent').innerHTML = persistent == 'true' ? 'Enabled' : 'Disabled';
        document.getElementById('persistent-button').innerHTML = persistent == 'true' ? 'Disable Persistence' : 'Enable Persistence';
        document.getElementById('persistent-button').classList.add(persistent == 'true' ? 'red' : 'green');
        // make login state invisible if not logged in
        var loggedin = decodeURIComponent(getParameterByName('loggedin'));
        var additional = "";
        if (loggedin == 'true') {
            var wbid = decodeURIComponent(getParameterByName('wbid'));
            var lastlocation = decodeURIComponent(getParameterByName('lastlocation'));
            document.getElementById('lastlocation').innerHTML = lastlocation;
            document.getElementById('wbid').innerHTML = wbid;
            document.getElementById('persistent-button').href = persistent == 'true' ? `/persistence?persistent=false&wbid=${wbid}&steamid=${steamid}&avatar=${profilePic}&persona=${profileName}&lastlocation=${lastlocation}&loggedin=true` : `/persistence?persistent=true&wbid=${wbid}&steamid=${steamid}&avatar=${profilePic}&persona=${profileName}&lastlocation=${lastlocation}&loggedin=true`;
            additional = `&lastlocation=${lastlocation}&wbid=${wbid}`;
            document.getElementById('persistence-text').innerHTML = "Progress is currently linked to your Steam account.";
            document.getElementById('persistent-button').style.display = 'none';
        } else {
            loggedin = 'false';
            document.getElementById('login-state').style.display = 'none';
            for(let i = 0; i < document.getElementsByClassName('persistencegoaway').length; i++) {
                document.getElementsByClassName('persistencegoaway')[i].style.display = 'none';
            }
            document.getElementById('persistence-text').innerHTML = "You do not have any progress linked to your Steam account.";
        }
        document.getElementById('get-started').href = `${document.getElementById('get-started').href}?avatar=${profilePic}&persona=${profileName}&steamid=${steamid}&loggedin=${loggedin}${additional}`;
    </script>
</body>